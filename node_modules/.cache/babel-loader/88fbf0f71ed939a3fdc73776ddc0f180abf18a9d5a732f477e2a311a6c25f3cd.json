{"ast":null,"code":"import _defineProperty from \"/Users/keith/progs/React/ACISQueryBuilder/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _toConsumableArray from \"/Users/keith/progs/React/ACISQueryBuilder/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _objectSpread from \"/Users/keith/progs/React/ACISQueryBuilder/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nexport function buildElement(elementKeys, elementValues) {\n  var action = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"add\";\n  var elem = {};\n  var subelems = [];\n  var mustBeNumber = ['duration', 'vX', 'vN', 'prec', 'base'];\n  elementKeys.forEach(function (item) {\n    if (elementValues[item] !== '') {\n      if (mustBeNumber.includes(item) && !isNaN(Number(elementValues[item]))) {\n        elem[item] = Number(elementValues[item]);\n      } else {\n        elem[item] = elementValues[item];\n      }\n    }\n  });\n  // if interval is a list, make it an array (not a string)\n  if (elem.hasOwnProperty('interval') && (elem.interval.includes(\",\") || elem.interval.includes(\"[\"))) {\n    elem.interval = elem.interval.replace(/[[\\]]/g, \"\").split(\",\").map(function (item) {\n      return Number(item);\n    });\n  }\n  // figure out whether or not selection is for single day\n  var notdly = typeof elem.duration === \"string\" && elem.duration !== 'dly' || typeof elem.duration === 'number' && (elem.duration !== 1 || elem.interval !== 'dly' && !(Array.isArray(elem.interval) && elem.interval.length === 3));\n  // can only have add for dly/dly; can only have reduce and max_missing if not dly/dly\n  if (notdly) {\n    delete elem.add;\n  } else {\n    //delete elem.reduce - commented out 14-Feb-2023 -kle\n    delete elem.maxmissing;\n  }\n  // can only have groupby if interval is not yly\n  if (elem.hasOwnProperty('interval') && (elem.interval === 'yly' || Array.isArray(elem.interval) && elem.interval.length === 1)) {\n    delete elem.groupby;\n  }\n  // can only have base for degree days\n  if (elem.hasOwnProperty('name') && !elem.name.includes(\"dd\")) {\n    delete elem.base;\n  }\n  // can only have season_start for std\n  if (elem.hasOwnProperty('duration') && elem.duration !== 'std') {\n    delete elem.season_start;\n  }\n  // if season_start is a list, make it an array (not a string)\n  if (elem.hasOwnProperty('season_start') && (elem.season_start.includes(\",\") || elem.season_start.includes(\"[\"))) {\n    elem.season_start = elem.season_start.replace(/[[\\]]/g, \"\").split(\",\").map(function (item) {\n      return Number(item);\n    });\n  }\n  // convert name of element sdate and edate\n  if (elem.hasOwnProperty('elem_sdate')) {\n    elem.sdate = elem.elem_sdate;\n    delete elem.elem_sdate;\n  }\n  if (elem.hasOwnProperty('elem_edate')) {\n    elem.edate = elem.elem_edate;\n    delete elem.elem_edate;\n  }\n  // build reduce object, if necessary\n  subelems = elementKeys.filter(function (item) {\n    return item.includes('reduce_');\n  });\n  if (elem.hasOwnProperty('reduce')) {\n    // can only have reduce_run_maxmissing if reduce is 'run'\n    if (!elem.reduce.includes('run')) {\n      delete elem.reduce_run_maxmissing;\n    }\n    var newObject = {};\n    subelems.forEach(function (item) {\n      if (elem.hasOwnProperty(item)) {\n        newObject[item.replace('reduce_', '')] = elem[item];\n        delete elem[item];\n      }\n    });\n    if (Object.keys(newObject).length > 0) {\n      elem.reduce = _objectSpread(_objectSpread({}, newObject), {}, {\n        reduce: elem.reduce\n      });\n    }\n  } else {\n    subelems.forEach(function (item) {\n      if (elem.hasOwnProperty(item)) {\n        delete elem[item];\n      }\n    });\n  }\n  // build smry object, if necessary\n  subelems = elementKeys.filter(function (item) {\n    return item.includes('smry_') && item !== 'smry_only';\n  });\n  if (elem.hasOwnProperty('smry')) {\n    // can only have smry_run_maxmissing if smry is 'run'\n    if (!elem.smry.includes('run')) {\n      delete elem.smry_run_maxmissing;\n    }\n    var _newObject = {};\n    subelems.forEach(function (item) {\n      if (elem.hasOwnProperty(item)) {\n        _newObject[item.replace('smry_', '')] = elem[item];\n        delete elem[item];\n      }\n    });\n    if (Object.keys(_newObject).length > 0) {\n      elem.smry = _objectSpread(_objectSpread({}, _newObject), {}, {\n        reduce: elem.smry\n      });\n    }\n  } else {\n    subelems.forEach(function (item) {\n      if (elem.hasOwnProperty(item)) {\n        delete elem[item];\n      }\n    });\n    delete elem.smry_only;\n  }\n  return elementValues.elems.includes(\"{\") && action !== \"replace\" ? [].concat(_toConsumableArray(JSON.parse(elementValues.elems)), [elem]) : [elem];\n}\nexport function buildImage(imageKeys, imageValues) {\n  var image = {};\n  imageKeys.forEach(function (item) {\n    if (imageValues[item] !== '') {\n      // width and height must be an integer (not a string)\n      image[item] = item === 'width' || item === 'height' ? Number(imageValues[item]) : imageValues[item];\n    }\n  });\n  // levels must be an array (not a string)\n  if (image.hasOwnProperty('levels')) {\n    image.levels = image.levels.replace(/[[\\]]/g, '').split(\",\").map(function (item) {\n      return Number(item);\n    });\n  }\n  // overlays must be an array if more than one are specified\n  if (image.hasOwnProperty('overlays') && image.overlays.includes(\",\")) {\n    image.overlays = image.overlays.replace(/[[\\]]/g, '').split(\",\").map(function (item) {\n      return item.replace(/[\"']/g, '');\n    });\n  }\n  return image;\n}\nexport function buildExplanation(params) {\n  var explanation = \"\";\n  var elems = null;\n  var monthName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n  var formatDate = function formatDate(date, rlen) {\n    var ymd = [];\n    if (date.includes(\"-\")) {\n      ymd = date.split(\"-\").map(function (item) {\n        return Number(item);\n      });\n    } else if (rlen === \"day\" && date.length === 8 || rlen === \"month\" && date.length === 6 || rlen === \"year\" && date.length === 4) {\n      ymd = [Number(date.substr(0, 4)), Number(date.substr(4, 2)), Number(date.substr(6, 2))];\n    } else if (date === 'por') {\n      return 'period of record';\n    } else {\n      return null;\n    }\n    if (rlen === \"year\") {\n      return ymd[0];\n    } else if (rlen === \"month\") {\n      return monthName[ymd[1] - 1] + \" \" + ymd[0];\n    } else if (rlen === \"day\") {\n      return monthName[ymd[1] - 1] + \" \" + ymd[2] + \", \" + ymd[0];\n    }\n    return null;\n  };\n  var badintervalMessage = \"Not a valid interval. Clear this element and add again with a valid interval.\";\n  var baddurationlMessage = \"Not a valid duration. Clear this element and add again with a valid duration.\";\n  var noreduceMessage = \"You need to specify a reduction for this request. Clear this element and add again with a reduction.\";\n  var noseasonstartMessage = \"You need to specify a 'season start' for a duration of 'std'. Clear this element and add again with a season start.\";\n  var baddateMessage = \"Invalid date specifications.\";\n  var durationText = {\n    mtd: \"month-to-date\",\n    std: \"season-to-date\",\n    ytd: \"year-to-date\"\n  };\n  var ymd = ['year', 'month', 'day'];\n  if (!params.hasOwnProperty('elems')) {\n    return null;\n  }\n  //process last element\n  try {\n    elems = typeof params.elems === \"string\" ? JSON.parse(params.elems).slice(-1)[0] : params.elems.slice(-1)[0];\n  } catch (_unused) {\n    return null;\n  }\n  // interpret the interval portion of the request\n  if (!elems.hasOwnProperty('interval')) {\n    return null;\n  }\n  var interval = elems.interval;\n  if (typeof interval === 'string') {\n    if (interval === 'dly') {\n      interval = [0, 0, 1];\n    } else if (interval === 'mly') {\n      interval = [0, 1];\n    } else if (interval === 'yly') {\n      interval = [1];\n    } else {\n      return badintervalMessage;\n    }\n  }\n  var intcnt = Math.max.apply(Math, _toConsumableArray(interval));\n  var intpos = interval.indexOf(intcnt);\n  if (interval.length < 1 || interval.length > 3 || intpos < 0) {\n    return badintervalMessage;\n  }\n  var intfreq = ymd[interval.length - 1];\n  var inttype = ymd[intpos];\n\n  // preocess duration/reduce portion\n  var duration = elems.hasOwnProperty('duration') ? elems.duration : 1;\n  var reduce = elems.hasOwnProperty('reduce') ? typeof elems.reduce === 'object' ? elems.reduce.reduce : elems.reduce : null;\n  if (duration === 'dly' || duration === 'mly' || duration === 'yly') {\n    duration = 1;\n  } else if (!isNaN(Number(duration))) {\n    duration = Number(duration);\n  }\n  if ((duration !== 1 || intfreq !== 'day') && !reduce) {\n    return noreduceMessage;\n  } else if (typeof duration === 'string' && !durationText.hasOwnProperty(duration)) {\n    return baddurationlMessage;\n  } else if (duration === 'std' && !elems.hasOwnProperty(\"season_start\")) {\n    return noseasonstartMessage;\n  } else if (duration !== 1 || intfreq !== 'day') {\n    var durphrase = typeof duration === 'string' ? durationText[duration] : duration + \"-\" + intfreq;\n    explanation += \"Each data value returned for this query element will be a \" + durphrase + \" \" + reduce;\n    // include season_start when appropriate\n    if (duration === 'std') {\n      if (typeof elems.season_start === \"string\") {\n        elems.season_start = elems.season_start.split(\"-\").map(function (item) {\n          return Number(item);\n        });\n      }\n      if (elems.season_start.length === 1) {\n        elems.season_start.push(1);\n      }\n      var season_start = monthName[elems.season_start[0] - 1] + \" \" + elems.season_start[1];\n      explanation += \" since \" + season_start;\n    }\n    explanation += \". \";\n  }\n  var intphrase = intcnt === 1 ? inttype : intcnt + \" \" + inttype + \"s\";\n  explanation += \"Results will consist of one value every \" + intphrase;\n  // date portion\n  if (params.hasOwnProperty('sdate') && params.hasOwnProperty('edate') || params.hasOwnProperty('date') || elems.hasOwnProperty('sdate') && elems.hasOwnProperty('edate')) {\n    var sdate = elems.sdate || params.sdate || params.date;\n    var edate = elems.edate || params.edate || null;\n    var sdatestr = formatDate(sdate, intfreq);\n    var edatestr = edate ? formatDate(edate, intfreq) : 'na';\n    if (!sdatestr || !edatestr) {\n      return baddateMessage;\n    }\n    if (intfreq === 'day' && intpos < 2) {\n      var sdparts = sdatestr.split(\", \");\n      var edparts = edatestr.split(\", \");\n      edatestr = sdparts[0] + \", \" + edparts[1];\n    } else if (intfreq === 'month' && intpos < 1) {\n      var _sdparts = sdatestr.split(\" \");\n      var _edparts = edatestr.split(\" \");\n      edatestr = _sdparts[0] + \" \" + _edparts[1];\n    }\n    var datephrase = elems.hasOwnProperty('reduce') ? \"the periods ending \" : \"\";\n    explanation += \" for \" + datephrase + sdatestr + (edatestr !== 'na' ? \" through \" + edatestr : \"\");\n  }\n  explanation += \". \";\n  return explanation;\n}\nexport function clearElementKeys(elementKeys) {\n  var clearedKeys = {};\n  elementKeys.forEach(function (e) {\n    clearedKeys = _objectSpread(_objectSpread({}, clearedKeys), _defineProperty({}, e, \"\"));\n  });\n  return clearedKeys;\n}\nexport function unbuildElements(dselems, elementKeys) {\n  var lastParsedElems;\n  try {\n    var parsedElems = JSON.parse(dselems);\n    lastParsedElems = parsedElems.at(-1);\n    if (lastParsedElems.hasOwnProperty('reduce') && typeof lastParsedElems.reduce === 'object') {\n      if (lastParsedElems.reduce.hasOwnProperty('add')) {\n        lastParsedElems = _objectSpread(_objectSpread({}, lastParsedElems), {\n          reduce_add: lastParsedElems.reduce.add\n        });\n      }\n      if (lastParsedElems.reduce.hasOwnProperty('n')) {\n        lastParsedElems = _objectSpread(_objectSpread({}, lastParsedElems), {\n          reduce_n: lastParsedElems.reduce.n\n        });\n      }\n      if (lastParsedElems.reduce.hasOwnProperty('run_maxmissing')) {\n        lastParsedElems = _objectSpread(_objectSpread({}, lastParsedElems), {\n          reduce_run_maxmissing: lastParsedElems.reduce.run_maxmissing\n        });\n      }\n      lastParsedElems = _objectSpread(_objectSpread({}, lastParsedElems), {\n        reduce: lastParsedElems.reduce.reduce\n      });\n    }\n    if (lastParsedElems.hasOwnProperty('smry') && typeof lastParsedElems.smry === 'object') {\n      if (lastParsedElems.smry.hasOwnProperty('add')) {\n        lastParsedElems = _objectSpread(_objectSpread({}, lastParsedElems), {\n          smry_add: lastParsedElems.smry.add\n        });\n      }\n      if (lastParsedElems.smry.hasOwnProperty('n')) {\n        lastParsedElems = _objectSpread(_objectSpread({}, lastParsedElems), {\n          smry_n: lastParsedElems.smry.n\n        });\n      }\n      if (lastParsedElems.smry.hasOwnProperty('run_maxmissing')) {\n        lastParsedElems = _objectSpread(_objectSpread({}, lastParsedElems), {\n          smry_run_maxmissing: lastParsedElems.smry.run_maxmissing\n        });\n      }\n      lastParsedElems = _objectSpread(_objectSpread({}, lastParsedElems), {\n        smry: lastParsedElems.smry.reduce\n      });\n    }\n  } catch (_unused2) {\n    lastParsedElems = {};\n  }\n  var clearedKeys = clearElementKeys(elementKeys);\n  return _objectSpread(_objectSpread({}, clearedKeys), lastParsedElems);\n}\nexport function basicFormat(results_json) {\n  var results_string = \"\";\n  var dataimage = \"\";\n  Object.keys(results_json).forEach(function (key) {\n    if (key === 'data' && results_json[key].includes(\"image/png;base64\")) {\n      dataimage = results_json[key];\n    } else if (Array.isArray(results_json[key])) {\n      results_string += key + \":\\n\";\n      results_json[key].forEach(function (item) {\n        results_string += \" \" + JSON.stringify(item) + \"\\n\";\n      });\n    } else {\n      results_string += key + \":\\n\";\n      results_string += \" \" + JSON.stringify(results_json[key]) + \"\\n\";\n    }\n  });\n  return {\n    results_string: results_string,\n    dataimage: dataimage\n  };\n}\nexport function checkHasInterval(update) {\n  if (update.length > 0 && update.includes(\"{\")) {\n    try {\n      var updateElems = JSON.parse(update);\n      var cond = false;\n      updateElems.forEach(function (ue) {\n        if (ue.hasOwnProperty('interval') && ue.interval.length) {\n          cond = true;\n        }\n      });\n      return cond;\n    } catch (_unused3) {\n      console.log('Error parsing elems update: ' + update);\n      return false;\n    }\n  } else {\n    return false;\n  }\n}\nexport function checkElemsError(strelems) {\n  try {\n    if (strelems.includes(\"{\")) {\n      // check for valid json\n      JSON.parse(strelems);\n    }\n    return false;\n  } catch (_unused4) {\n    return true;\n  }\n}\nexport function updateState(datafields, elementKeys, input_params, resetElemsBuilder) {\n  var imageKeys = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [];\n  var resetImageBuilder = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;\n  var newstate = {};\n  var checkHasIntervalStatus = false;\n  var checkElemsErrorStatus = false;\n  datafields.forEach(function (key) {\n    if (input_params.hasOwnProperty(key)) {\n      if (key === 'elems') {\n        var strelems = typeof input_params.elems === 'object' ? JSON.stringify(input_params.elems) : input_params.elems;\n        newstate = _objectSpread(_objectSpread({}, newstate), {\n          elems: strelems\n        });\n        checkHasIntervalStatus = checkHasInterval(strelems);\n        checkElemsErrorStatus = checkElemsError(strelems);\n        if (resetElemsBuilder && strelems.length > 0) {\n          var lastParsedElems = unbuildElements(strelems, elementKeys);\n          newstate = _objectSpread(_objectSpread({}, newstate), lastParsedElems);\n        }\n      } else if (key === 'image') {\n        console.log(key + \" \" + imageKeys);\n        var strimg = typeof input_params.image === 'object' ? JSON.stringify(input_params.image) : input_params.image;\n        newstate = _objectSpread(_objectSpread({}, newstate), {\n          elems: strimg\n        });\n        if (resetImageBuilder && strimg.length > 0) {\n          var parsedImage = unbuildElements(strimg, imageKeys);\n          newstate = _objectSpread(_objectSpread({}, newstate), parsedImage);\n        }\n      } else {\n        newstate = _objectSpread(_objectSpread({}, newstate), _defineProperty({}, key, input_params[key]));\n      }\n    } else {\n      newstate = _objectSpread(_objectSpread({}, newstate), _defineProperty({}, key, ''));\n    }\n  });\n  return {\n    newstate: newstate,\n    checkHasIntervalStatus: checkHasIntervalStatus,\n    checkElemsErrorStatus: checkElemsErrorStatus\n  };\n}","map":{"version":3,"names":["buildElement","elementKeys","elementValues","action","elem","subelems","mustBeNumber","forEach","item","includes","isNaN","Number","hasOwnProperty","interval","replace","split","map","notdly","duration","Array","isArray","length","add","maxmissing","groupby","name","base","season_start","sdate","elem_sdate","edate","elem_edate","filter","reduce","reduce_run_maxmissing","newObject","Object","keys","smry","smry_run_maxmissing","smry_only","elems","JSON","parse","buildImage","imageKeys","imageValues","image","levels","overlays","buildExplanation","params","explanation","monthName","formatDate","date","rlen","ymd","substr","badintervalMessage","baddurationlMessage","noreduceMessage","noseasonstartMessage","baddateMessage","durationText","mtd","std","ytd","slice","intcnt","Math","max","intpos","indexOf","intfreq","inttype","durphrase","push","intphrase","sdatestr","edatestr","sdparts","edparts","datephrase","clearElementKeys","clearedKeys","e","unbuildElements","dselems","lastParsedElems","parsedElems","at","reduce_add","reduce_n","n","run_maxmissing","smry_add","smry_n","basicFormat","results_json","results_string","dataimage","key","stringify","checkHasInterval","update","updateElems","cond","ue","console","log","checkElemsError","strelems","updateState","datafields","input_params","resetElemsBuilder","resetImageBuilder","newstate","checkHasIntervalStatus","checkElemsErrorStatus","strimg","parsedImage"],"sources":["/Users/keith/progs/React/ACISQueryBuilder/src/builders.js"],"sourcesContent":["export function buildElement(elementKeys, elementValues, action=\"add\") {\n  let elem = {}\n  let subelems = []\n  const mustBeNumber = ['duration','vX','vN','prec','base']\n  elementKeys.forEach((item) => {\n    if (elementValues[item] !== '') {\n      if (mustBeNumber.includes(item) && !isNaN(Number(elementValues[item]))) {\n        elem[item] = Number(elementValues[item])\n      } else {\n        elem[item] = elementValues[item]\n      }\n    }\n  })\n  // if interval is a list, make it an array (not a string)\n  if (elem.hasOwnProperty('interval') && (elem.interval.includes(\",\") || elem.interval.includes(\"[\"))) {\n    elem.interval = elem.interval.replace(/[[\\]]/g,\"\").split(\",\").map((item) => {return Number(item)})\n  }\n  // figure out whether or not selection is for single day\n  const notdly = (typeof elem.duration === \"string\" && elem.duration !== 'dly') || \n    (typeof elem.duration === 'number' && (elem.duration !== 1 || (elem.interval !== 'dly' && !(Array.isArray(elem.interval) && elem.interval.length === 3))))\n  // can only have add for dly/dly; can only have reduce and max_missing if not dly/dly\n  if (notdly) {\n    delete elem.add\n  } else {\n    //delete elem.reduce - commented out 14-Feb-2023 -kle\n    delete elem.maxmissing\n  }\n  // can only have groupby if interval is not yly\n  if (elem.hasOwnProperty('interval') && (elem.interval === 'yly' || (Array.isArray(elem.interval) && elem.interval.length === 1))) {\n    delete elem.groupby\n  }\n  // can only have base for degree days\n  if (elem.hasOwnProperty('name') && !elem.name.includes(\"dd\")) {\n    delete elem.base\n  }\n  // can only have season_start for std\n  if (elem.hasOwnProperty('duration') && elem.duration !== 'std') {\n    delete elem.season_start\n  }\n  // if season_start is a list, make it an array (not a string)\n  if (elem.hasOwnProperty('season_start') && (elem.season_start.includes(\",\") || elem.season_start.includes(\"[\"))) {\n    elem.season_start = elem.season_start.replace(/[[\\]]/g,\"\").split(\",\").map((item) => {return Number(item)})\n  }\n  // convert name of element sdate and edate\n  if (elem.hasOwnProperty('elem_sdate')) {\n    elem.sdate = elem.elem_sdate\n    delete elem.elem_sdate\n  }\n  if (elem.hasOwnProperty('elem_edate')) {\n    elem.edate = elem.elem_edate\n    delete elem.elem_edate\n  }\n  // build reduce object, if necessary\n  subelems = elementKeys.filter(item => item.includes('reduce_'))\n  if (elem.hasOwnProperty('reduce')) {\n    // can only have reduce_run_maxmissing if reduce is 'run'\n    if (!elem.reduce.includes('run')) {\n      delete elem.reduce_run_maxmissing\n    }\n    let newObject = {}\n    subelems.forEach((item) => { \n      if (elem.hasOwnProperty(item)) {\n        newObject[item.replace('reduce_','')] = elem[item]\n        delete elem[item]\n      }\n    })\n    if (Object.keys(newObject).length > 0) {\n      elem.reduce = {...newObject, reduce:elem.reduce}\n    }\n  } else {\n    subelems.forEach((item) => { \n      if (elem.hasOwnProperty(item)) {\n          delete elem[item]\n      }\n    })\n  }\n  // build smry object, if necessary\n  subelems = elementKeys.filter(item => item.includes('smry_') && item !== 'smry_only')\n  if (elem.hasOwnProperty('smry')) {\n    // can only have smry_run_maxmissing if smry is 'run'\n    if (!elem.smry.includes('run')) {\n      delete elem.smry_run_maxmissing\n    }\n    let newObject = {}\n    subelems.forEach((item) => { \n      if (elem.hasOwnProperty(item)) {\n        newObject[item.replace('smry_','')] = elem[item]\n        delete elem[item]\n      }\n    })\n    if (Object.keys(newObject).length > 0) {\n      elem.smry = {...newObject, reduce:elem.smry}\n    }\n  } else {\n    subelems.forEach((item) => { \n      if (elem.hasOwnProperty(item)) {\n        delete elem[item]\n      }\n    })\n    delete elem.smry_only\n  }\n  return elementValues.elems.includes(\"{\") && action !== \"replace\"  ? [...JSON.parse(elementValues.elems), elem] : [elem]\n}\n\nexport function buildImage(imageKeys, imageValues) {\n  let image = {}\n  imageKeys.forEach((item) => {\n    if (imageValues[item] !== '') {\n      // width and height must be an integer (not a string)\n      image[item] = (item === 'width' || item === 'height') ? Number(imageValues[item]) : imageValues[item]\n    }\n  })\n  // levels must be an array (not a string)\n  if (image.hasOwnProperty('levels')) {\n    image.levels = image.levels.replace(/[[\\]]/g,'').split(\",\").map((item) => {return Number(item)})\n  }\n  // overlays must be an array if more than one are specified\n  if (image.hasOwnProperty('overlays') && image.overlays.includes(\",\")) {\n    image.overlays = image.overlays.replace(/[[\\]]/g,'').split(\",\").map((item) => {return item.replace(/[\"']/g,'')})\n  }\n  return image\n}\n\nexport function buildExplanation(params) {\n  let explanation = \"\"\n  let elems = null\n  const monthName = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']\n  const formatDate = (date, rlen) => {\n    let ymd = []\n    if (date.includes(\"-\")) {\n      ymd = date.split(\"-\").map(item => {return Number(item)})\n    } else if ((rlen === \"day\" && date.length === 8) || (rlen === \"month\" && date.length === 6) || (rlen === \"year\" && date.length === 4)) {\n      ymd = [Number(date.substr(0,4)), Number(date.substr(4,2)), Number(date.substr(6,2))]\n    } else if (date === 'por') {\n      return 'period of record'\n    } else {\n      return null\n    }\n    if (rlen === \"year\") {\n      return ymd[0]\n    } else if (rlen === \"month\") {\n      return monthName[ymd[1]-1] + \" \" + ymd[0]\n    } else if (rlen === \"day\") {\n      return monthName[ymd[1]-1] + \" \" + ymd[2] + \", \" + ymd[0]\n    }\n    return null\n  }\n  const badintervalMessage = \"Not a valid interval. Clear this element and add again with a valid interval.\"\n  const baddurationlMessage = \"Not a valid duration. Clear this element and add again with a valid duration.\"\n  const noreduceMessage = \"You need to specify a reduction for this request. Clear this element and add again with a reduction.\"\n  const noseasonstartMessage = \"You need to specify a 'season start' for a duration of 'std'. Clear this element and add again with a season start.\"\n  const baddateMessage = \"Invalid date specifications.\"\n   const durationText = {mtd:\"month-to-date\", std:\"season-to-date\", ytd:\"year-to-date\"}\n  const ymd = ['year','month','day']\n  if (!params.hasOwnProperty('elems')) {\n    return null\n  }\n  //process last element\n  try {\n    elems = typeof params.elems === \"string\" ? JSON.parse(params.elems).slice(-1)[0]: params.elems.slice(-1)[0]\n  } catch {\n    return null\n  }\n  // interpret the interval portion of the request\n  if (!elems.hasOwnProperty('interval')) {\n    return null\n  }\n  let interval = elems.interval\n  if (typeof interval === 'string') {\n    if (interval === 'dly') {\n      interval = [0,0,1]\n    } else if (interval === 'mly') {\n      interval = [0,1]\n    } else if (interval === 'yly') {\n      interval = [1]\n    } else {\n      return badintervalMessage\n    }\n  }\n  const intcnt = Math.max(...interval)\n  const intpos = interval.indexOf(intcnt)\n  if (interval.length < 1 || interval.length > 3 || intpos < 0) {\n    return badintervalMessage\n  }\n  const intfreq = ymd[interval.length-1]\n  const inttype = ymd[intpos]\n  \n  // preocess duration/reduce portion\n  let duration = elems.hasOwnProperty('duration') ? elems.duration : 1\n  const reduce = elems.hasOwnProperty('reduce') ? (typeof elems.reduce === 'object' ? elems.reduce.reduce : elems.reduce) : null\n  if (duration === 'dly' || duration === 'mly' || duration === 'yly') {\n    duration = 1\n  } else if (!isNaN(Number(duration))) {\n    duration = Number(duration)\n  }\n  if ((duration !== 1 || intfreq !== 'day') && !reduce) {\n    return noreduceMessage\n  } else if (typeof duration === 'string' && !durationText.hasOwnProperty(duration)) {\n    return baddurationlMessage\n  } else if (duration === 'std' && !elems.hasOwnProperty(\"season_start\")) {\n    return noseasonstartMessage\n  } else if (duration !== 1 || intfreq !== 'day') {\n    const durphrase = typeof duration === 'string' ? durationText[duration] : (duration + \"-\" + intfreq)\n    explanation += \"Each data value returned for this query element will be a \" + durphrase + \" \" + reduce\n    // include season_start when appropriate\n    if (duration === 'std') {\n      if (typeof elems.season_start === \"string\") {\n        elems.season_start = elems.season_start.split(\"-\").map(item => { return Number(item) })\n      }\n      if (elems.season_start.length === 1) {\n        elems.season_start.push(1)\n      }\n      const season_start = monthName[elems.season_start[0]-1] + \" \" + elems.season_start[1]\n      explanation += \" since \" + season_start\n    }\n    explanation += \". \"\n  }\n  const intphrase = intcnt === 1 ? inttype : (intcnt + \" \" + inttype + \"s\")\n  explanation += \"Results will consist of one value every \" + intphrase\n  // date portion\n  if ((params.hasOwnProperty('sdate') && params.hasOwnProperty('edate')) || \n      params.hasOwnProperty('date') ||\n      (elems.hasOwnProperty('sdate') && elems.hasOwnProperty('edate'))) {\n    const sdate = elems.sdate || params.sdate || params.date\n    const edate = elems.edate || params.edate || null\n    let sdatestr = formatDate(sdate, intfreq)\n    let edatestr = edate ? formatDate(edate, intfreq) : 'na'\n    if (!sdatestr || !edatestr) {\n      return baddateMessage\n    }\n    if (intfreq === 'day' && intpos < 2) {\n      const sdparts = sdatestr.split(\", \")\n      const edparts = edatestr.split(\", \")\n      edatestr = sdparts[0] + \", \" + edparts[1]\n    } else if (intfreq === 'month' && intpos < 1) {\n      const sdparts = sdatestr.split(\" \")\n      const edparts = edatestr.split(\" \")\n      edatestr = sdparts[0] + \" \" + edparts[1]\n    }\n    const datephrase = elems.hasOwnProperty('reduce') ? \"the periods ending \" : \"\"\n    explanation += \" for \" + datephrase + sdatestr + (edatestr !== 'na' ? \" through \" + edatestr : \"\")\n  }\n  explanation += \". \" \n    \n  return explanation\n}\n\nexport function clearElementKeys(elementKeys) {\n  let clearedKeys = {}\n  elementKeys.forEach((e) => {\n    clearedKeys = {...clearedKeys, ...{[e]:\"\"}}\n  })\n  return clearedKeys\n}\n\nexport function unbuildElements(dselems, elementKeys) {\n  var lastParsedElems\n  try {\n    const parsedElems = JSON.parse(dselems)\n    lastParsedElems = parsedElems.at(-1)\n    if (lastParsedElems.hasOwnProperty('reduce') && typeof lastParsedElems.reduce === 'object') {\n      if (lastParsedElems.reduce.hasOwnProperty('add')) {\n        lastParsedElems = {...lastParsedElems, ...{reduce_add: lastParsedElems.reduce.add}}\n      }\n      if (lastParsedElems.reduce.hasOwnProperty('n')) {\n        lastParsedElems = {...lastParsedElems, ...{reduce_n: lastParsedElems.reduce.n}}\n      }\n      if (lastParsedElems.reduce.hasOwnProperty('run_maxmissing')) {\n        lastParsedElems = {...lastParsedElems, ...{reduce_run_maxmissing: lastParsedElems.reduce.run_maxmissing}}\n      }\n      lastParsedElems = {...lastParsedElems, ...{reduce: lastParsedElems.reduce.reduce}}\n    }\n    if (lastParsedElems.hasOwnProperty('smry') && typeof lastParsedElems.smry === 'object') {\n      if (lastParsedElems.smry.hasOwnProperty('add')) {\n        lastParsedElems = {...lastParsedElems, ...{smry_add: lastParsedElems.smry.add}}\n      }\n      if (lastParsedElems.smry.hasOwnProperty('n')) {\n        lastParsedElems = {...lastParsedElems, ...{smry_n: lastParsedElems.smry.n}}\n      }\n      if (lastParsedElems.smry.hasOwnProperty('run_maxmissing')) {\n        lastParsedElems = {...lastParsedElems, ...{smry_run_maxmissing: lastParsedElems.smry.run_maxmissing}}\n      }\n      lastParsedElems = {...lastParsedElems, ...{smry: lastParsedElems.smry.reduce}}\n    }\n  } catch {\n    lastParsedElems = {}\n  }\n  const clearedKeys = clearElementKeys(elementKeys)\n  return {...clearedKeys, ...lastParsedElems}\n}\n\nexport function basicFormat(results_json) {\n  let results_string = \"\"\n  let dataimage = \"\"\n  Object.keys(results_json).forEach(key => {\n    if (key === 'data' && results_json[key].includes(\"image/png;base64\")) {\n      dataimage = results_json[key]\n    } else if (Array.isArray(results_json[key])) {\n      results_string += key + \":\\n\"\n      results_json[key].forEach(item => {\n        results_string += \" \" + JSON.stringify(item) + \"\\n\"\n      }) \n    } else {\n      results_string += key + \":\\n\"\n      results_string += \" \" + JSON.stringify(results_json[key]) + \"\\n\"\n    }\n  })\n  return {results_string: results_string, dataimage: dataimage}\n}\n\nexport function checkHasInterval(update) {\n  if (update.length > 0 && update.includes(\"{\")) {\n    try {\n      let updateElems = JSON.parse(update)\n      let cond = false\n      updateElems.forEach((ue) => {\n        if (ue.hasOwnProperty('interval') && ue.interval.length) {\n          cond = true\n        }\n      })\n      return cond\n    } catch {\n      console.log('Error parsing elems update: ' + update)\n      return false\n    }\n  } else {\n    return false\n  }\n}\n\nexport function checkElemsError(strelems) {\n  try {\n    if (strelems.includes(\"{\")) {\n      // check for valid json\n      JSON.parse(strelems)\n    }\n    return false\n  } catch {\n    return true\n  }    \n}\n\nexport function updateState(datafields, elementKeys, input_params, resetElemsBuilder, imageKeys=[], resetImageBuilder=false) {\n  let newstate= {}\n  let checkHasIntervalStatus = false\n  let checkElemsErrorStatus = false\n  datafields.forEach((key) => {\n    if (input_params.hasOwnProperty(key)) {\n      if (key === 'elems') {\n        const strelems = typeof input_params.elems === 'object' ? JSON.stringify(input_params.elems) : input_params.elems\n        newstate = ({...newstate, ...{elems: strelems}})\n        checkHasIntervalStatus = checkHasInterval(strelems)\n        checkElemsErrorStatus = checkElemsError(strelems)\n        if (resetElemsBuilder && strelems.length > 0) {\n          const lastParsedElems = unbuildElements(strelems, elementKeys)\n          newstate = {...newstate, ...lastParsedElems}\n        }\n      } else if (key === 'image') {\n        console.log(key + \" \" + imageKeys)\n        const strimg = typeof input_params.image === 'object' ? JSON.stringify(input_params.image) : input_params.image\n        newstate = ({...newstate, ...{elems: strimg}})\n        if (resetImageBuilder && strimg.length > 0) {\n          const parsedImage = unbuildElements(strimg, imageKeys)\n          newstate = {...newstate, ...parsedImage}\n        }\n      } else {\n        newstate= ({...newstate, ...{[key]: input_params[key]}})\n      }\n    } else {\n      newstate = ({...newstate, ...{[key]: ''}})\n    }\n  })\n  return {newstate, checkHasIntervalStatus, checkElemsErrorStatus}\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}